<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <script type="application/javascript" src='https://cyilin36.github.io/js/theme-mode.js'></script>
    <link rel="stylesheet" href='https://cyilin36.github.io/css/frameworks.min.css' />
    <link rel="stylesheet" href='https://cyilin36.github.io/css/github.min.css' />
    <link rel="stylesheet" href='https://cyilin36.github.io/css/github-style.css' />
    <link rel="stylesheet" href='https://cyilin36.github.io/css/light.css' />
    <link rel="stylesheet" href='https://cyilin36.github.io/css/dark.css' />
    <link rel="stylesheet" href='https://cyilin36.github.io/css/syntax.css' />
    <title>稍微剑走偏锋的nas方案——2 - cyilin&#39;s blog</title>
    
    <link rel="icon" type="image/x-icon" href='/images/favicon.png'>
    
    <meta name="theme-color" content="#1e2327">

    
    

    
    <meta name="description"
  content="让家里的小姐姐来到你的身边~" />
<meta name="keywords"
  content='' />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://cyilin36.github.io/post/%E7%A8%8D%E5%BE%AE%E5%89%91%E8%B5%B0%E5%81%8F%E9%94%8B%E7%9A%84nas%E6%96%B9%E6%A1%882/" />


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="稍微剑走偏锋的nas方案——2 - cyilin&#39;s blog" />
<meta name="twitter:description"
  content="让家里的小姐姐来到你的身边~" />
<meta name="twitter:site" content="https://cyilin36.github.io/" />
<meta name="twitter:creator" content="" />
<meta name="twitter:image"
  content="https://cyilin36.github.io/">


<meta property="og:type" content="article" />
<meta property="og:title" content="稍微剑走偏锋的nas方案——2 - cyilin&#39;s blog">
<meta property="og:description"
  content="让家里的小姐姐来到你的身边~" />
<meta property="og:url" content="https://cyilin36.github.io/post/%E7%A8%8D%E5%BE%AE%E5%89%91%E8%B5%B0%E5%81%8F%E9%94%8B%E7%9A%84nas%E6%96%B9%E6%A1%882/" />
<meta property="og:site_name" content="稍微剑走偏锋的nas方案——2" />
<meta property="og:image"
  content="https://cyilin36.github.io/">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2025-01-01 20:32:08 &#43;0800 CST" />











</head>


<body>
  <div style="position: relative">
  <header class="Header js-details-container Details px-3 px-md-4 px-lg-5 flex-wrap flex-md-nowrap open Details--on">
    <div class="Header-item mobile-none" style="margin-top: -4px; margin-bottom: -4px;">
      <a class="Header-link" href="https://cyilin36.github.io/">
        <img class="octicon" height="32" width="32" src="/images/avatar.png">
      </a>
    </div>
    <div class="Header-item d-md-none">
      <button class="Header-link btn-link js-details-target" type="button"
        onclick="document.querySelector('#header-search').style.display = document.querySelector('#header-search').style.display == 'none'? 'block': 'none'">
        <svg height="24" class="octicon octicon-three-bars" viewBox="0 0 16 16" version="1.1" width="24">
          <path fill-rule="evenodd" d="M1 2.75A.75.75 0 011.75 2h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 2.75zm0 5A.75.75 0 011.75 7h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 7.75zM1.75 12a.75.75 0 100 1.5h12.5a.75.75 0 100-1.5H1.75z">
          </path>
        </svg>
      </button>
    </div>
    <div style="display: none;" id="header-search"
      class="Header-item Header-item--full flex-column flex-md-row width-full flex-order-2 flex-md-order-none mr-0 mr-md-3 mt-3 mt-md-0 Details-content--hidden-not-important d-md-flex">
      <div
        class="Header-search header-search flex-auto js-site-search position-relative flex-self-stretch flex-md-self-auto mb-3 mb-md-0 mr-0 mr-md-3 scoped-search site-scoped-search js-jump-to">
        <div class="position-relative">
          
          <form target="_blank" id="search-form" action="" accept-charset="UTF-8" method="get"
            autocomplete="off">
            <label
              class="Header-search-label form-control input-sm header-search-wrapper p-0 js-chromeless-input-container header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center">
              <input type="text"
                class="Header-search-input form-control input-sm header-search-input jump-to-field js-jump-to-field js-site-search-focus js-site-search-field is-clearable"
                name="q" value="" placeholder="Search" autocomplete="off">
            </label>
          </form>
          
        </div>
      </div>
    </div>

    <div class="Header-item Header-item--full flex-justify-center d-md-none position-relative">
      <a class="Header-link " href="https://cyilin36.github.io/">
        <img class="octicon octicon-mark-github v-align-middle" height="32" width="32" src="/images/avatar.png">
      </a>
    </div>
    <div class="Header-item" style="margin-right: 0;">
      <a href="javascript:void(0)" class="Header-link no-select" onclick="switchTheme()">
        <svg style="fill: var(--color-profile-color-modes-toggle-moon);" class="no-select" viewBox="0 0 16 16"
          version="1.1" width="16" height="16">
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M4.52208 7.71754C7.5782 7.71754 10.0557 5.24006 10.0557 2.18394C10.0557 1.93498 10.0392 1.68986 10.0074 1.44961C9.95801 1.07727 10.3495 0.771159 10.6474 0.99992C12.1153 2.12716 13.0615 3.89999 13.0615 5.89383C13.0615 9.29958 10.3006 12.0605 6.89485 12.0605C3.95334 12.0605 1.49286 10.001 0.876728 7.24527C0.794841 6.87902 1.23668 6.65289 1.55321 6.85451C2.41106 7.40095 3.4296 7.71754 4.52208 7.71754Z">
          </path>
        </svg>
      </a>
    </div>
  </header>
</div>

  <div id="search-result" class="container-lg px-3 new-discussion-timeline" style="display: none;">
</div>

  
<div class="application-main">
  <div>
  <main>
    <div class="gisthead pagehead bg-gray-light pb-0 pt-3 mb-4">
      <div class="px-0">
        <div class="mb-3 d-flex px-3 px-md-3 px-lg-5">
          <div class="flex-auto min-width-0 width-fit mr-3">
            <div class="d-flex">
              <div class="d-none d-md-block">
                <a class="avatar mr-2 flex-shrink-0" href="https://cyilin36.github.io/">
                  <img class=" avatar-user"
                    src="/images/avatar.png"
                    width="32" height="32"></a>
              </div>
              <div class="d-flex flex-column">
                <h1 class="break-word f3 text-normal mb-md-0 mb-1">
                  <span class="author">
                    <a href="https://cyilin36.github.io/">cyilin</a>
                  </span>
                  <span class="path-divider">/</span>
                  <strong class="css-truncate css-truncate-target mr-1" style="max-width: 410px">
                    <a href="https://cyilin36.github.io/post/%E7%A8%8D%E5%BE%AE%E5%89%91%E8%B5%B0%E5%81%8F%E9%94%8B%E7%9A%84nas%E6%96%B9%E6%A1%882/">稍微剑走偏锋的nas方案——2</a>
                  </strong>
                </h1>
                <div class="note m-0">
                  Created <relative-time datetime="Wed, 01 Jan 2025 20:32:08 &#43;0800"
                    class="no-wrap">
                    Wed, 01 Jan 2025 20:32:08 &#43;0800</relative-time>

                  
                  <span class="file-info-divider"></span>
                  Modified <relative-time datetime="Wed, 24 Sep 2025 20:37:49 &#43;0800"
                    class="no-wrap">
                    Wed, 24 Sep 2025 20:37:49 &#43;0800</relative-time>
                  
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container-lg px-3 new-discussion-timeline">
      <div class="repository-content gist-content">
        <div>
          <div class="js-gist-file-update-container js-task-list-container file-box">
            <div id="file-pytest" class="file my-2">
              <div id="post-header" class="file-header d-flex flex-md-items-center flex-items-start sticky-header" style="z-index: 2">
                <div class="file-info d-flex flex-md-items-center flex-items-start flex-order-1 flex-auto">
                  <div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">
                    
                    <summary id="toc-toggle" onclick="clickToc()" class="btn btn-octicon m-0 mr-2 p-2">
                      <svg aria-hidden="true" viewBox="0 0 16 16" height="16" width="16" class="octicon octicon-list-unordered">
                        <path fill-rule="evenodd" d="M2 4a1 1 0 100-2 1 1 0 000 2zm3.75-1.5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zM3 8a1 1 0 11-2 0 1 1 0 012 0zm-1 6a1 1 0 100-2 1 1 0 000 2z"></path>
                      </svg>
                    </summary>
                    <details-menu class="SelectMenu" id="toc-details" style="display: none;">
                      <div class="SelectMenu-modal rounded-3 mt-1" style="max-height: 340px;">
                        <div class="SelectMenu-list SelectMenu-list--borderless p-2" style="overscroll-behavior: contain;" id="toc-list">
                        </div>
                      </div>
                    </details-menu>
                      6150 Words
                    

                  </div>
                  <div class="file-actions flex-order-2 pt-0">
                    
                    
                    <a class="muted-link mr-3" href="/tags/nas">
                      <svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16">
                        <path fill-rule="evenodd"
                          d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z">
                        </path>
                      </svg>
                      nas
                    </a>
                    
                    <a class="muted-link mr-3" href="/tags/ddns">
                      <svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16">
                        <path fill-rule="evenodd"
                          d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z">
                        </path>
                      </svg>
                      DDNS
                    </a>
                    
                    <a class="muted-link mr-3" href="/tags/%E4%B8%AD%E7%BB%A7%E8%BD%AC%E5%8F%91">
                      <svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16">
                        <path fill-rule="evenodd"
                          d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z">
                        </path>
                      </svg>
                      中继转发
                    </a>
                    
                    <a class="muted-link mr-3" href="/tags/%E5%9F%9F%E5%90%8D">
                      <svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16">
                        <path fill-rule="evenodd"
                          d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z">
                        </path>
                      </svg>
                      域名
                    </a>
                    
                    
                  </div>
                </div>
              </div>


              <div class="Box-body px-5 pb-5" style="z-index: 1">
                <article class="markdown-body entry-content container-lg"><h1 id="前言">前言</h1>
<p>在前面我们设置了一个已经成功搭建了一个nas系统，并且在其他设备上成功访问了nas。但是目前也就只能在同一个局域网中才能访问。还得用其他其他手段才能在外部网络中连接上家里的nas设备。如果还没有搭建nas系统，可以参考前面的博客：<strong>稍微剑走偏锋的nas方案——1</strong></p>
<p>现在，让我们解决如何<strong>随地访问</strong>的问题。</p>
<p>我们在局域网访问nas，是通过在相关软件（比如浏览器和资源管理器）输入nas的ip地址和端口来访问，那么在同理在外地访问也是用同一套方案，在互联网上连接到我们家里面nas设备的ip地址即可。所以，解决思路是通过各种手段来在互联网来访问我们nas的ip地址。</p>
<p>可以在互联网直接访问到的ip我们称为——<strong>公网IP</strong>，公网ip现在也分两种：ipv4和ipv6。在我国，由于分配到的公网ipv4数量稀少，因此绝大部分人都没有公网ipv4 <del>（不同地区不同情况，据说在香港公网ipv4几乎是多到用不完，可恶）</del> ；公网ipv6虽然数量很多且现在家庭宽带几乎都有，可以做到每台设备一个，但是还没有完全普及，而且给的公网ipv6基本都是动态会变动的那种；并且ipv4和ipv6又互不相通的，因此我们远程在互联网访问就分化出以下三个方案：</p>
<ul>
<li><strong>DDNS转发公网ip</strong></li>
<li><strong>内网穿透</strong></li>
<li><strong>中继转发</strong></li>
</ul>
<hr>
<h1 id="ddns转发公网ip">DDNS转发公网ip</h1>
<p>首先我们需要了解<a href="https://baike.baidu.com/item/%E5%9F%9F%E5%90%8D%E7%B3%BB%E7%BB%9F/2251573">DNS</a>和<a href="https://baike.baidu.com/item/ddns/670146">DDNS</a>是个什么玩意：</p>
<blockquote>
<p>（omainameystem，缩写：）是互联网的一项服务。它作为将域名和P地址相互映射的一个分布式数据库，能够使人更方便地访问互联网。（ynamicomainameerver，动态域名服务）是将用户的动态IP地址映射到一个固定的域名解析服务上，用户每次连接网络的时候客户端程序就会通过信息传递把该主机的动态IP地址传送给位于服务商主机上的服务器程序，服务器程序负责提供DNS服务并实现动态域名解析。</p></blockquote>
<p>简单来说，就是我们平时输入的网址其实是匹配一个一个服务器的ip，输入网址就会解析处相对的ip，这就是<strong>dns。</strong> 为了避免因为动态ip问题而需要不停的修改网站对应的ip这个问题，把ip实时和域名组合在一起，叫<strong>ddns</strong>。</p>
<p>如果有静态公网ip那么可以在浏览器直接输入nas的公网<code>ip:端口</code>即可成功访问nas，手上没有相关静态公网ip但有动态公网ip的才需要用ddns技术。那么我们需要准备两样东西：<strong>个人域名</strong>、<strong>ddns软件</strong></p>
<h2 id="个人域名">个人域名</h2>
<h3 id="购买">购买</h3>
<p>个人域名的获取需要到各家互联网域名商去购买，我这边使用的是<a href="https://www.aliyun.com/">阿里云</a>。</p>
<p>我们首先进入阿里云官网并注册登陆，然后再搜索栏搜索<code>域名注册</code>​</p>
<p>​<img src="/images/20250924102824.png" alt=""></p>
<p>然后搜索你想要建立的域名，比如<code>asdadsahdah</code>​</p>
<p>​<img src="/images/20250924102830.png" alt=""></p>
<p>挑选一个还未注册且价格便宜的入手即可，比如<code>asdadsahdah.top</code>。</p>
<h3 id="网站权限的账户密码获取">网站权限的账户密码获取</h3>
<p>购买成功后，我们点击右上角<code>控制台&gt;全部域名&gt;域名列表</code>，确认购买的域名。确认入库后，点击<code>右上角头像&gt;AccessKey</code>，然后勾选提示并点击<code>继续使用云账号AccessKey</code>。</p>
<p>​<img src="/images/20250924102836.png" alt=""></p>
<p>接着点击<code>创建AccessKey</code>，然后完成一系列验证后就可以拿到一个<strong>AccessKey ID</strong>和<strong>AccessKey Secret</strong>。<strong>请保管好这AccessKey ID和AccessKey Secret，拿到的人相当于对该网站拥有实际控制权！一定要保管好且不要泄密，就和你的steam号不外借是同一个道理！</strong> 我们要复制好AccessKey ID和AccessKey Secret，这两个在关闭页面就无法在看到了，因此要提前存放好。</p>
<h2 id="ddns软件的选择">DDNS软件的选择</h2>
<p>DDNS软件的选择有很多，比如<a href="https://github.com/jeessy2/ddns-go">ddns-go</a>，<a href="https://github.com/gdy666/lucky">lucky</a>等，这边使用对windows操作更加顺手的lucky来作为演示。</p>
<p>我们下载完lucky并安装在nas上以后，启动lucky，并在右下角小图标处右键lucky图标，设置为<code>开机自启动</code>，然后点击<code>打开lucky后台</code>进入到webui页面</p>
<p><img src="/images/20250924102840.png" alt=""></p>
<p>我们输入账号和密码（默认都是：<code>666</code>），点击<code>设置</code>，把管理账号和密码修改成你自己的。<strong>外网访问</strong>按需打开。</p>
<p><img src="/images/20250924102844.png" alt=""></p>
<p>设置好并重新登陆lucky后台，我们点击<code>动态域名&gt;添加任务</code>，然后把相关信息填写上，域名写刚刚购买的域名，AccessKey ID和AccessKey Secret就填写刚刚建立的。类型选择上如果有公网ipv4就选择公网ipv4，有公网ipv6就选择公网ipv6，都有的话建议多添加一次任务，把ipv4和ipv6都解析了。</p>
<p>​<img src="/images/20250924102849.png" alt=""></p>
<p>注意：我们购买的域名一般都是主域名，子域名是挂载在主域名下的，不需要额外购买，因此我们可以在<strong>域名列表</strong>处写入子域名。</p>
<p>子域名命名规则其实很简单，组合方式为：<code>你要的域名名称.主域名</code>，和之前一样，比如我购买的主域名为<code>asdadsahdah.top</code>，那么子域名我可以设置为<code>abc123.asdadsahdah.top</code>，其中这个<code>abc123</code>可以是任何英文和数字。</p>
<p><img src="/images/20250924102853.png" alt=""></p>
<p>都填入正确并添加成功后应该可以看到这个页面</p>
<p>​<img src="/images/20250924102858.png" alt=""></p>
<p>可以看到<strong>公网ip未改变</strong>或者<strong>成功上传ip</strong>的相关字样</p>
<h2 id="远程访问nas">远程访问nas</h2>
<p>现在我们已经成功将ip和域名配置成功，那么就可以来访问测试一下。在浏览器输入<code>域名:端口</code>即可访问。前文我安装了飞牛os和emby服务器，运行的端口号分别是<code>5666</code>和<code>8096</code>，那么我在浏览器输入<code>域名:5666</code>和<code>域名:8096</code>既可。</p>
<p>​<img src="/images/20250924102902.png" alt=""></p>
<h2 id="ssl证书">SSL证书</h2>
<p>我们上面的一系列操作完成后都只是能在<code>http</code>上访问，而<code>http</code>在现在互联网中其实相当于明文传输，相当不安全，因此建议加上SSL证书来达成<code>https</code>访问。至于SSL是什么东西，请看下面的文章：</p>
<p><a href="https://baike.baidu.com/item/SSL%E8%AF%81%E4%B9%A6/5201468">SSL证书——百度百科</a></p>
<h3 id="添加ssl证书">添加SSL证书</h3>
<p>之所以前面选择lucky作为ddns软件，就是因为它不单止可以作为ddns转发，还可以帮我们续签SSL证书。我们点击<code>SSL/TLS证书&gt;添加证书</code>，添加方式选择<code>ACME</code>，证书机构推荐使用<code>Let's Encrypt</code>，验证方式选择<code>阿里云</code>（在什么地方买得域名就选择什么），<strong>ID</strong>和<strong>Secret</strong>写入之前获取的AssessKey，域名写入刚刚ddns设置的域名（比如前文的<code>abc123.asdadsahdah.top</code>），也可以写入你的<code>主域名</code>和<code>*.主域名</code>（比如<code>asdadsahdah.top</code>和<code>*.asdadsahdah.top</code>）</p>
<p>​<img src="/images/20250924102907.png" alt=""></p>
<h3 id="反向代理">反向代理</h3>
<p>添加完SSL证书后，我们还需要设置反向代理，把<code>https</code>的域名指向本机的ip</p>
<p>我们点击<code>web服务&gt;添加web服务规则</code>，设置一个端口号，然后把<code>TLS</code>打开。接着点击<code>添加子规则</code>，前端地址写入<strong>ddns设置的域名，</strong> 后端地址写入<code>本机ip:端口</code>，在点击<code>添加web服务规则</code>即可。</p>
<p>​<img src="/images/20250924102912.png" alt=""></p>
<p>如图，这样一番设置后，我在浏览器输入<code>https://abc123.asdadsahdah.top:10010</code>，先是会通过<strong>ddns</strong>来解析到nas公网ip地址，然后通过lucky的反向代理，<code>10010</code>端口的流量指向<code>192.168.110.1:8096</code>，我们就可以浏览到<code>192.168.110.1</code>这台设备<code>8096</code>端口上的内容了。而前面emby服务是运行在<code>8096</code>端口，因此输入<code>https://abc123.asdadsahdah.top:10010</code>即可远程访问机器上的emby服务器。<del><strong>小姐姐就可以随时随地的来到我们身边了。</strong></del></p>
<p>反向代理的端口是可以复用的，因此你可以把<code>abc123.asdadsahdah.top:10010</code>指向emby，把<code>gskandp.asdadsahdah.top:10010</code>指向nas系统等</p>
<h2 id="ipv4和ipv6互不相通">IPV4和IPV6互不相通</h2>
<p>前面说了，ipv4的网络无法访问只有ipv6地址的网站，反过来也一样，因此你需要确认你的域名和你的流量都支持同一个<strong>网际协议版本</strong>（<strong>I</strong>nternet<strong>P</strong>rotocol<strong>v</strong>ersion，缩写：<strong>ipv</strong>）。如果你和我一样，只有公网ipv6，那么在通过这样的办法连接家里设备之前，先去<a href="https://test-ipv6.cs.umd.edu/index.html.zh_CN">测试一下ipv6</a>吧。</p>
<p>​<img src="/images/20250924102918.png" alt=""></p>
<p>现在国内的绝大部分手机都是兼容ipv4和ipv6流量的，因此手机流量应该可以直接访问ipv6地址的网页。</p>
<p>目前阿里云平台的ipv6转ipv4是需按照流量收费的，而赛博善人<strong>cloudflare</strong>则是不用，我们可以免费使用cloudflare的cdn服务来实现<strong>v4v6均可访问。</strong> 但由于cloudflare是美国公司，因此速度方面会比较感人，有舍有得吧。碍于篇幅这里暂且搁置不谈，以后有机会再填坑。 <del><strong>（咕咕咕）</strong></del></p>
<hr>
<h1 id="内网穿透">内网穿透</h1>
<p>如果家里没有公网ip，那么我们得用<strong>内网穿透</strong>的方式来把两台设备连接在一起。内网穿透的定义是</p>
<blockquote>
<p>内网穿透，也即 NAT 穿透，进行 NAT 穿透是为了使具有某一个特定源 IP 地址和源端口号的数据包不被 NAT 设备屏蔽而正确路由到内网主机。</p></blockquote>
<p>在这里，我选择zerotier作为内网穿透工具，它通过<strong>虚拟局域网（VLAN）</strong> 技术将不同设备连接到一个“虚拟的局域网”中，让设备随时随地都可以互相访问。</p>
<h2 id="注册并配置zerotier客户端">注册并配置zerotier客户端</h2>
<p>我们必须先去zerotier注册并并且建立一个虚拟局域网先。</p>
<p><a href="https://www.zerotier.com/">ZeroTier | Global Networking Solution for IoT, SD-WAN, and VPN</a></p>
<h3 id="设置zerotier局域网">设置zerotier局域网</h3>
<p>注册并登陆zerotier后，选择<code>free</code>计划，然后我们可以看到这个页面</p>
<p>​<img src="/images/20250924102924.png" alt=""></p>
<p>我们点击上面的<code>Create A Network</code>就可以看到下面多出一个条目</p>
<p>​<img src="/images/20250924102930.png" alt=""></p>
<p>点击进入后，我们首先来到，我们需要注意以下几个地方</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Network ID    <span style="color:#75715e">#该局域网的识别码，对于任何设备想要添加进入这个虚拟局域网都需要这个ID</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Name    <span style="color:#75715e">#给该局域网设置名称，任意即可</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Description    <span style="color:#75715e">#给该局域网设置相关描述，任意即可</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Access Control    <span style="color:#75715e">#加入局域网的控制权限，请尽量保持Private，这样每个设备加入局域网都需要在你的zerotier帐户上同意后方可加入，可以提高安全性</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>IPv4 Auto-Assign    <span style="color:#75715e">#请尽量选择easy里面的几个网段，这些都是容易记住的，不建议在advanced里面自己设置网段</span>
</span></span></code></pre></div><h3 id="安装zerotier-docker客户端">安装zerotier docker客户端</h3>
<p>我们可以到zerotier的<code>Download</code>处下载到相关系统的客户端，想要安装在nas系统里面的可以选择<code>docker</code>版本。以飞牛os的docker为例。</p>
<p>在docker中搜索并安装zerotier</p>
<p>​<img src="/images/20250924102935.png" alt=""></p>
<p>然后建立镜像，记得勾选<code>开机自启动</code>，在<code>存储位置</code>处添加路径映射，把一个你想要放置zerotier文件的文件夹映射<code>/var/lib/zerotier-one</code>文件夹，比如</p>
<p>​<img src="/images/20250924102939.png" alt=""></p>
<p>功能处选择使用<code>高权限执行容器</code>​</p>
<p><img src="/images/20250924102943.png" alt=""></p>
<p>网络选择<code>host</code>（先取消勾选<code>bridge</code>然后再选择<code>host</code>）</p>
<p>​<img src="/images/20250924102947.png" alt=""></p>
<p>点击<code>设置&gt;SSH</code>，打开<code>SSH功能</code>，我们需要远程ssh来给zerotier容器添加<code>Network ID</code>​</p>
<p>​<img src="/images/20250924102952.png" alt=""></p>
<p>打开任意一个ssh工具，这边我使用的是<a href="https://mobaxterm.mobatek.net/">MobaXterm</a>。打开MobaXterm，点击<code>Session&gt;ssh</code>，<strong>Remote host</strong>  ***** 输入<code>nas的ip地址</code>​ <em>。</em></p>
<p>​<img src="/images/20250924102957.png" alt=""></p>
<p>nas的ip地址可以再nas的<code>系统设置&gt;网络设置</code>中找到</p>
<p>​<img src="/images/20250924103001.png" alt=""></p>
<p>对着左侧列表的ip地址右键选择<code>Connect as…</code>，然后输入自己nas的账户名，这样就成功连接上nas的ssh</p>
<p>​<img src="/images/20250924103005.png" alt=""></p>
<p>接下来所有的命令我们需要在<strong>root</strong>权限下，因此我们输入<code>sudo -i</code>，然后输入自己nas的密码来进入到root权限中。<strong>注意，输入密码的时候是不会显示密码的，要盲打</strong></p>
<p>​<img src="/images/20250924103010.png" alt=""></p>
<p>接下来执行以下操作</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker ps    <span style="color:#75715e">#查看docker中zerotier容器的名字，可选，其实在fnos中的docker看也一样</span>
</span></span><span style="display:flex;"><span>docker exec -it zeroier容器名字 zerotier-cli status    <span style="color:#75715e">#查看节点状态，返回 200 info 就算成功</span>
</span></span><span style="display:flex;"><span>docker exec -it zeroier容器名字 zerotier-cli join zerotierID <span style="color:#75715e">#加入虚拟局域网，zerotierID就是你的Network ID</span>
</span></span></code></pre></div><p>此时再度进入<a href="https://www.zerotier.com/">zerotier的官网</a>并进入你方才建立的局域网，现在你应该发现就会有一个设备出现在页面上</p>
<p>​<img src="/images/20250924103016.png" alt=""></p>
<p>​<code>Name</code>是给添加进入的设备起名称，可以随意，<code>Managed IPs</code>则是虚拟局域网内的ip，这个ip就是zerotier局域网的ip。这样一台设备就真正的加入到虚拟局域网中了。注意，zerotier局域网的网段和家里真实局域网的网段不能相同。</p>
<p>可以尝试一下，比如家里的局域网网段是<code>192.168.110.x</code>，zerotier的局域网网段是<code>192.168.193.x</code>，两台设备之间<code>ping zerotierIP</code>可以ping通，就算成功。</p>
<h3 id="安装zerotier-windows端">安装zerotier Windows端</h3>
<p>我们还是来到zerotier官网的<code>Download</code>处，选择下载Windows版本</p>
<p>​<img src="/images/20250924103020.png" alt=""></p>
<p>下载下来应该是一个<code>.msi</code>文件。双击进行安装，安装完毕后在<strong>右下角小图标</strong>出应该可以找到zerotier的图标，接着<code>右键&gt;join new network</code>，弹出的提示框内输入虚拟局域网的<code>Network ID</code>，然后跟上面的一样，在zerotier局域网管理页面运行设备加入即可。</p>
<h2 id="zerotier-路由转发">zerotier 路由转发</h2>
<p>其实我们可以更近一步，通过设备的转发功能，<strong>实现一台设备安装zerotier，那么该局域网的所有设备都被添加进zerotier局域网的效果。</strong> 由于本人使用openwrt作为旁路由进行zerotier转发，因此下面举例是基于openwrt的，飞牛OS和Windows的也各自有教程</p>
<p><a href="https://club.fnnas.com/forum.php?mod=viewthread&amp;tid=6658">zerotier 内网穿透实用教程 - 攻略分享 飞牛私有云论坛 fnOS</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/692352622">windows下利用zerotier虚拟网访问局域网其他电脑 - 知乎</a></p>
<p>我们进入openwrt的后台并输入</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>opkg update    <span style="color:#75715e">#更新软件包</span>
</span></span><span style="display:flex;"><span>opkg install zerotier    <span style="color:#75715e">#安装zerotier</span>
</span></span></code></pre></div><p>随后进入openwrt webui，来到<code>VPN&gt;zerotier</code>，把<code>启用</code>打开，并输入局域网的<code>Network ID</code>到<code>ZeroTier Network ID</code>处，并把<code>自动允许客户端 NAT打开</code>，然后选择<strong>保存并应用。</strong></p>
<p>​<img src="/images/20250924103024.png" alt=""></p>
<p>回到zerotier局域网管理页面，我们找到<code>Settings&gt;Advanced&gt;Managed Routes</code>，在<code>Add Routes</code>进行路由表的配置。<code>Destination</code>输入自己<strong>本地局域网的网段，</strong> 比如我家里的nas ip地址是192.168.110.5，那么我就应该输入<code>192.168.110.0/24</code>。</p>
<p>​<code>Via</code>则是输入自己想要进行转发的设备，比如我要用opnewrt进行转发，该设备在zerotier的局域网中ip为<code>192.168.193.2</code>，那么就输入<code>192.168.193.2</code>。然后点击<code>Submit</code>来提交。</p>
<p>​<img src="/images/20250924103028.png" alt=""></p>
<p>这样我外面的设备连接上zerotier局域网后，输入的设备就直接输入<strong>真实局域网的ip</strong>就可以了，再也不用多记ip且一个一个设备安装zerotier了。</p>
<p>​<img src="/images/20250924103033.png" alt=""></p>
<hr>
<h1 id="中继转发">中继转发</h1>
<p>有些nas系统的服务商其实是配置了中继转发的，飞牛的中继转发叫做<strong>FN Connect。</strong> 开启后输入指定连接后边可以直接连接。如果是在同一局域网内，那么它会自动帮你切换成局域网内连接，不然就会通过飞牛的服务器把你的外部设备和nas连接在一起。</p>
<p>由于是经过了飞牛的服务器，因此速度是有限制的，还是更加推荐zerotier或者是ddns。</p>
<p>我们进入到<code>设置&gt;设备信息&gt;飞牛账号</code>中，用自己的手机号注册一个飞牛帐户。注册完成后继续来到<code>远程访问</code>中，把<strong>FN ID</strong>输入一个自己的id名（不可跟他人重复），然后打开<strong>FN Connect</strong>即可。</p>
<p>我们再回到<code>设备信息</code>处，就可以看到<code>FN Connect</code>处有一个连接，这个就是专属连接，直接再浏览器输入便可以连接到飞牛nas了</p>
<p><img src="/images/20250924103038.png" alt=""></p>
<p>当然我们用中继转发的话只能连接飞牛nas，是无法连接Windows电脑和emby之类的服务的。虽然仿佛简单，但是局限也大。</p>
<hr>
<p>这么一大串下来，我们终于是把常用的远程连接都说完了。谁能想到，我本来只打算弄一个远程观看毛片的，结果把这一串玩意都折腾完了。忍不住感叹一句</p>
<blockquote>
<p>好奇是科学发展的原动力，色欲也是。</p></blockquote>
</article>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
<script type="application/javascript" src='https://cyilin36.github.io/js/toc.js'></script>
<link rel="stylesheet" href='https://cyilin36.github.io/css/toc.css' />

  
<div id="gitalk-container" class="gitalk-container"></div>
<link rel="stylesheet" href='https://cyilin36.github.io/css/gitalk.css'>
<script src='https://cyilin36.github.io/js/gitalk.min.js'></script>
<script>
  const gitalk = new Gitalk({
    clientID: 'Ov23liQKtrtwT2Ax2000',
    clientSecret: '77542d944ee38787b154727e269a2417718b7a90',
    repo: 'cyilin36.github.io',
    owner: 'cyilin36',
    admin: ['cyilin36'],
    id: eval("location.pathname"), 
    distractionFreeMode: false 
  });
  (function() {
    gitalk.render('gitalk-container');
  })();
</script>

</div>

  
</body>

<script type="application/javascript" src="https://cyilin36.github.io/js/github-style.js"></script>





<script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.min.js"></script>
<script type="application/javascript" src='https://cyilin36.github.io/js/search.js'></script>



</html>